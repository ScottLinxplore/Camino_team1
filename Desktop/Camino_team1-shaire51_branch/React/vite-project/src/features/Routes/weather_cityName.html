<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>æ³•åœ‹ä¹‹è·¯5å¤©å¤©æ°£é å ±</title>
  <style>
    body {
      font-family: sans-serif;
      border: 3px solid;
      padding: 20px;
      background: #f3f3f3;
    }

    .weather-card {
      background: white;
      padding: 10px 20px;
      margin-bottom: 20px;
      border-radius: 10px;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
    }

    .weather-card img {
      vertical-align: middle;
    }

    .city-title {
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
  <h1>æ³•åœ‹ä¹‹è·¯ 5 å¤©å¤©æ°£é å ±ï¼ˆæ¯æ—¥ä¸­åˆï¼‰</h1>
  <div id="update"></div>
  <div id="weather"></div>

  <script>
    const apiKey = "3299837f5a88b62374e450abea252d20";
    const cities = [
      "Saint-Jean-Pied-de-Port,fr", "Roncesvalles,es", "Zubiri,es", "Pamplona,es",
      "Puente la Reina,es", "Estella,es", "Los Arcos,es", "Viana,es", "Logrono,es",
      "Navarrete,es", "Najera,es", "Santo Domingo de la Calzada,es", "Granon,es",
      "Belorado,es", "Villafranca Montes de Oca,es", "San Juan de Ortega,es", "Burgos,es",
      "Hornillos del Camino,es", "Castrojeriz,es", "Fromista,es", "Carrion de los Condes,es",
      "Calzadilla de la Cueza,es", "Sahagun,es", "El Burgo Ranero,es", "Mansilla de las Mulas,es",
      "Leon,es", "Hospital de Orbigo,es", "Astorga,es", "Ponferrada,es", "Sarria,es"
    ];

    const weatherDiv = document.getElementById("weather");
    const update = document.getElementById("update");

    function getWeather() {
      weatherDiv.innerHTML = "";
      update.innerHTML = "<h3>è³‡æ–™æ›´æ–°ä¸­...</h3>";

      const fetchPromises = cities.map((city, index) => {
        const url = `https://api.openweathermap.org/data/2.5/forecast?q=${encodeURIComponent(city)}&appid=${apiKey}&units=metric&lang=zh_tw`;

        return fetch(url)
          .then(res => res.json())
          .then(data => {
            // å–æ¯å¤©ä¸­åˆ12é»çš„é å ±
            const dailyForecasts = data.list.filter(item => item.dt_txt.includes("12:00:00")).slice(0, 5);

            return {
              index,
              name: data.city.name,
              forecasts: dailyForecasts.map(item => ({
                date: new Date(item.dt * 1000).toLocaleDateString("zh-TW"),
                temp: item.main.temp.toFixed(1),
                desc: item.weather[0].description,
                icon: item.weather[0].icon
              }))
            };
          })
          .catch(err => ({
            index,
            name: city,
            error: true,
            message: "è®€å–å¤±æ•—"
          }));
      });

      Promise.all(fetchPromises).then(results => {
        results.sort((a, b) => a.index - b.index);

        results.forEach(item => {
          if (item.error) {
            weatherDiv.innerHTML += `
              <div class="weather-card">
                <h2>${item.index + 1}. ${item.name}</h2>
                <p>âŒ ${item.message}</p>
              </div>
            `;
          } else {
            let forecastHTML = item.forecasts.map(forecast => `
              <div>
                ğŸ“… ${forecast.date} ï½œ ğŸŒ¥ï¸ ${forecast.desc} ï½œ ğŸŒ¡ï¸ ${forecast.temp}Â°C
                <img src="https://openweathermap.org/img/wn/${forecast.icon}@2x.png" alt="${forecast.desc}" />
              </div>
            `).join("");

            weatherDiv.innerHTML += `
              <div class="weather-card">
                <h2 class="city-title">${item.index + 1}. ${item.name}</h2>
                ${forecastHTML}
              </div>
            `;
          }
        });

        update.innerHTML = `<h4>âœ… æœ€å¾Œæ›´æ–°æ™‚é–“ï¼š${new Date().toLocaleTimeString("zh-TW")}</h4>`;
      });
    }

    getWeather();
    setInterval(getWeather, 1000 * 60 * 5);
  </script>
</body>
</html>
